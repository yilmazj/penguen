<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Nihilist Penguin: The Endless Walk</title>
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#eef2f3">
    
    <style>
        body { margin: 0; overflow: hidden; background-color: #eef2f3; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; }
        #canvas-container { width: 100vw; height: 100vh; display: block; }
        
        /* UI Katmanı */
        #ui-layer {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; /* Dokunmaları canvas'a geçir */
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10;
        }

        #start-screen {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            pointer-events: auto;
        }

        h1 { color: #333; font-size: 24px; margin-bottom: 10px; font-weight: 300; letter-spacing: 2px; text-transform: uppercase; }
        p { color: #666; font-size: 14px; margin-bottom: 30px; line-height: 1.5; }
        
        button {
            background: #000;
            color: #fff;
            border: none;
            padding: 15px 40px;
            font-size: 16px;
            border-radius: 50px;
            cursor: pointer;
            transition: transform 0.2s;
            font-weight: 600;
        }
        button:active { transform: scale(0.95); }

        /* Joystick Alanı - Tüm ekran dokunulabilir */
        #joystick-zone {
            position: absolute;
            bottom: 0; left: 0;
            width: 100%;
            height: 100%;
            z-index: 5;
            display: none; /* Başlangıçta gizli */
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/nipplejs/0.9.0/nipplejs.min.js"></script>
</head>
<body>

    <div id="ui-layer">
        <div id="start-screen">
            <h1>Nihilist Penguen</h1>
            <p>Sürüden ayrıldın. Geri dönüş yok.<br>Sadece soğuk ve sonsuzluk var.</p>
            <button id="start-btn">Yürüyüşe Başla</button>
        </div>
    </div>

    <div id="joystick-zone"></div>
    <div id="canvas-container"></div>

    <script>
        // --- Değişkenler ---
        let scene, camera, renderer;
        let penguin, penguinGroup;
        let societyGroup; // Arkadaki diğer penguenler
        let joystickManager;
        let moveData = { forward: 0, turn: 0 };
        let isGameActive = false;
        
        // Renk Paleti (Fotoğrafa sadık kalarak)
        const colors = {
            fog: 0xeef2f3, // Fotoğraftaki o buzlu beyaz/gri
            ground: 0xeef2f3,
            penguinBlack: 0x1a1a1a,
            penguinWhite: 0xffffff,
            mountain: 0xdde4e8
        };

        // --- Başlangıç ---
        document.getElementById('start-btn').addEventListener('click', () => {
            document.getElementById('start-screen').style.display = 'none';
            document.getElementById('joystick-zone').style.display = 'block';
            isGameActive = true;
            initJoystick();
            
            // Tam ekran isteği (Opsiyonel, mobilde hissi artırır)
            if (document.documentElement.requestFullscreen) {
                document.documentElement.requestFullscreen().catch(e => {});
            }
        });

        init3D();
        animate();

        function init3D() {
            // 1. Sahne Kurulumu
            scene = new THREE.Scene();
            scene.background = new THREE.Color(colors.fog);
            // Sis: Sonsuzluk hissi için en önemli kısım bu. Ufuk çizgisini yok eder.
            scene.fog = new THREE.FogExp2(colors.fog, 0.015);

            // 2. Kamera (GTA Açısı)
            camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(0, 5, -8); // Penguenin arkasında ve biraz yukarısında
            
            // 3. Renderer
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.shadowMap.enabled = true;
            document.getElementById('canvas-container').appendChild(renderer.domElement);

            // 4. Işıklandırma
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
            scene.add(ambientLight);

            const dirLight = new THREE.DirectionalLight(0xffffff, 0.5);
            dirLight.position.set(50, 100, 50);
            dirLight.castShadow = true;
            scene.add(dirLight);

            // 5. Zemin (Sonsuzluk İllüzyonu)
            // Çok büyük bir zemin yapıyoruz.
            const planeGeometry = new THREE.PlaneGeometry(1000, 1000);
            const planeMaterial = new THREE.MeshPhongMaterial({ color: colors.ground, shininess: 0 });
            const ground = new THREE.Mesh(planeGeometry, planeMaterial);
            ground.rotation.x = -Math.PI / 2;
            ground.receiveShadow = true;
            scene.add(ground);

            // 6. Dağlar (Dekor)
            // Uzakta, ulaşılamaz dağlar.
            createMountains();

            // 7. Oyuncu Penguen
            createPlayerPenguen();

            // 8. "Diğerleri" (Toplum)
            // Başlangıç noktasının çok gerisine koyuyoruz.
            createSociety();

            // Resize Handler
            window.addEventListener('resize', onWindowResize, false);
        }

        function createPenguenMesh() {
            const group = new THREE.Group();

            // Gövde (Basit bir kapsül/silindir formu)
            const bodyGeo = new THREE.CapsuleGeometry(0.5, 1, 4, 8);
            const bodyMat = new THREE.MeshStandardMaterial({ color: colors.penguinBlack });
            const body = new THREE.Mesh(bodyGeo, bodyMat);
            body.position.y = 0.75;
            body.castShadow = true;
            group.add(body);

            // Göbek (Beyazlık)
            const bellyGeo = new THREE.CapsuleGeometry(0.35, 0.8, 4, 8);
            const bellyMat = new THREE.MeshStandardMaterial({ color: colors.penguinWhite });
            const belly = new THREE.Mesh(bellyGeo, bellyMat);
            belly.position.set(0, 0.7, 0.25); // Biraz öne
            group.add(belly);

            // Kafa
            const headGeo = new THREE.SphereGeometry(0.4, 16, 16);
            const head = new THREE.Mesh(headGeo, bodyMat);
            head.position.y = 1.6;
            group.add(head);

            // Gaga
            const beakGeo = new THREE.ConeGeometry(0.1, 0.3, 8);
            const beakMat = new THREE.MeshStandardMaterial({ color: 0xffa500 });
            const beak = new THREE.Mesh(beakGeo, beakMat);
            beak.rotation.x = Math.PI / 2;
            beak.position.set(0, 1.6, 0.5);
            group.add(beak);

            // Kanatlar
            const flipperGeo = new THREE.BoxGeometry(0.8, 0.1, 0.3);
            const flipper = new THREE.Mesh(flipperGeo, bodyMat);
            flipper.position.set(0, 1.2, 0);
            group.add(flipper);

            return group;
        }

        function createPlayerPenguen() {
            penguinGroup = new THREE.Group();
            const mesh = createPenguenMesh();
            penguinGroup.add(mesh);
            scene.add(penguinGroup);
        }

        function createSociety() {
            societyGroup = new THREE.Group();
            
            // Arkada 5-6 tane penguen olsun
            for(let i=0; i<7; i++) {
                const p = createPenguenMesh();
                // Penguenin arkasına (Z ekseninde negatif), biraz rastgele dağılmış
                p.position.set(
                    (Math.random() - 0.5) * 20, 
                    0, 
                    -30 - (Math.random() * 20)
                );
                p.rotation.y = Math.PI; // Sırtları dönük olabilir ya da bize bakabilirler.
                // Bize baksınlar, yargılar gibi.
                societyGroup.add(p);
            }
            scene.add(societyGroup);
        }

        function createMountains() {
            // Ufukta rastgele koniler
            for (let i = 0; i < 40; i++) {
                const h = 20 + Math.random() * 50;
                const geo = new THREE.ConeGeometry(10 + Math.random()*20, h, 4); // Low poly
                const mat = new THREE.MeshStandardMaterial({ 
                    color: colors.mountain, 
                    flatShading: true,
                    roughness: 1
                });
                const mesh = new THREE.Mesh(geo, mat);
                
                // Oyuncudan çok uzağa koyuyoruz (Sis içinde kalacaklar)
                const angle = Math.random() * Math.PI * 2;
                const radius = 150 + Math.random() * 100;
                
                mesh.position.x = Math.cos(angle) * radius;
                mesh.position.z = Math.sin(angle) * radius;
                mesh.position.y = h / 2 - 5; // Biraz gömülü
                
                scene.add(mesh);
            }
        }

        function initJoystick() {
            const zone = document.getElementById('joystick-zone');
            
            // Nipple.js konfigürasyonu
            joystickManager = nipplejs.create({
                zone: zone,
                mode: 'dynamic', // Ekranda nereye basarsan orada çıkar
                position: { left: '50%', top: '50%' },
                color: 'white',
                size: 120,
                dynamicPage: true
            });

            joystickManager.on('move', function (evt, data) {
                if(data.vector) {
                    // Joystick verisini işle
                    // y ileri geri, x sağ sol dönüş
                    moveData.forward = data.vector.y; 
                    moveData.turn = -data.vector.x; // Sağa çevirince sağa dönsün
                }
            });

            joystickManager.on('end', function () {
                moveData.forward = 0;
                moveData.turn = 0;
            });
        }

        function updateGameLogic() {
            if (!isGameActive) return;

            // 1. Hareket
            const speed = 0.2;
            const turnSpeed = 0.08;

            // Dönüş
            penguinGroup.rotation.y += moveData.turn * turnSpeed;

            // İleri gitme (Sadece penguenin baktığı yöne)
            // Eğer joystick ileri itiliyorsa hareket et
            if (moveData.forward > 0.1) {
                // Penguenin baktığı yönü hesapla
                const direction = new THREE.Vector3(0, 0, 1);
                direction.applyAxisAngle(new THREE.Vector3(0, 1, 0), penguinGroup.rotation.y);
                
                penguinGroup.position.add(direction.multiplyScalar(speed * moveData.forward));
                
                // Yürüyüş animasyonu (Basit bir sağa sola sallanma)
                penguinGroup.children[0].rotation.z = Math.sin(Date.now() * 0.01) * 0.1;
            } else {
                 penguinGroup.children[0].rotation.z = 0;
            }

            // 2. Kamera Takibi (GTA Style - Smooth)
            // Hedef kamera pozisyonu: Penguenin arkası
            const relativeCameraOffset = new THREE.Vector3(0, 5, -10); // Penguenin arkası
            const cameraOffset = relativeCameraOffset.applyMatrix4(penguinGroup.matrixWorld);
            
            // Lerp ile yumuşak geçiş
            camera.position.lerp(cameraOffset, 0.1);
            camera.lookAt(penguinGroup.position);

            // 3. Nihilizm Mekaniği (Ulaşılamayan Toplum)
            // Diğer penguenlerin olduğu "societyGroup" ile oyuncu arasındaki mesafeyi kontrol et.
            // Eğer oyuncu onlara (negatif Z eksenine doğru) gidiyorsa, onları uzaklaştır.
            
            // Oyuncu Z ekseninde geriye gidiyorsa (Society'e doğru)
            const dist = penguinGroup.position.distanceTo(societyGroup.position);
            
            // Hile burada: Eğer oyuncu onlara yaklaşıyorsa (belli bir mesafeden fazla),
            // grubu oyuncudan uzaklaştırıyoruz. 
            // Onlar sabit duruyor gibi görünüyor ama aslında kaçıyorlar.
            
            // Basit vektör mantığı: Society ile Player arasındaki vektörü al.
            // Eğer mesafe 40 birimden aza düşerse...
            if (dist < 40) {
               // Society'i oyuncunun baktığı yönün tersine it
               // Ya da daha basiti: Oyuncu onlara doğru dönükse ve hareket ediyorsa,
               // Society grubunu da aynı vektörde hareket ettir.
               
               // Oyuncunun hareket vektörünü alıp society'e ekle
               const direction = new THREE.Vector3(0, 0, 1);
               direction.applyAxisAngle(new THREE.Vector3(0, 1, 0), penguinGroup.rotation.y);
               
               // Eğer oyuncu society'e doğru bakıyorsa
               // Dot product ile kontrol edebiliriz ama basit tutalım:
               // Sadece pozisyonu öteleyelim.
               societyGroup.position.add(direction.multiplyScalar(speed * moveData.forward));
            }

            // Sonsuzluk döngüsü: Oyuncu çok uzaklaşırsa kordinatları sıfırlamak yerine
            // Three.js'in float limitlerine kadar gidebiliriz, sorun yok.
            // Ama zemin dokusu olmadığı için zemin kaydırmaya gerek yok, düz beyaz.
        }

        function animate() {
            requestAnimationFrame(animate);
            updateGameLogic();
            renderer.render(scene, camera);
        }

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

    </script>
</body>
</html>
