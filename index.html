<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Nihilist Penguin: The Endless Walk</title>
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#eef2f3">
    
    <style>
        body { margin: 0; overflow: hidden; background-color: #eef2f3; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; }
        
        /* Canvas'ı garantiye alalım, en arkada dursun */
        #canvas-container { 
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%; 
            z-index: 1; /* En alt katman */
        }
        
        /* UI Katmanı (Start ekranı) */
        #ui-layer {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10; /* En üst katman */
        }

        #start-screen {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            pointer-events: auto;
        }

        h1 { color: #333; font-size: 24px; margin-bottom: 10px; font-weight: 300; letter-spacing: 2px; text-transform: uppercase; }
        p { color: #666; font-size: 14px; margin-bottom: 30px; line-height: 1.5; }
        
        button {
            background: #000;
            color: #fff;
            border: none;
            padding: 15px 40px;
            font-size: 16px;
            border-radius: 50px;
            cursor: pointer;
            transition: transform 0.2s;
            font-weight: 600;
        }
        button:active { transform: scale(0.95); }

        /* Joystick Alanı - Tüm ekran dokunulabilir */
        #joystick-zone {
            position: absolute;
            top: 0; left: 0;
            width: 100%;
            height: 100%;
            z-index: 5; /* Canvas ile UI arasında */
            display: none; /* Başlangıçta gizli */
            outline: none; /* Tıklanınca mavi çerçeve çıkmasın */
            -webkit-tap-highlight-color: transparent;
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/nipplejs/0.9.0/nipplejs.min.js"></script>
</head>
<body>

    <div id="canvas-container"></div>
    <div id="joystick-zone"></div>

    <div id="ui-layer">
        <div id="start-screen">
            <h1>Nihilist Penguen</h1>
            <p>Sürüden ayrıldın. Geri dönüş yok.<br>Sadece soğuk ve sonsuzluk var.</p>
            <button id="start-btn">Yürüyüşe Başla</button>
        </div>
    </div>

    <script>
        // --- Değişkenler ---
        let scene, camera, renderer;
        let penguinGroup;
        let societyGroup; // Arkadaki diğer penguenler
        let joystickManager;
        let moveData = { forward: 0, turn: 0 };
        let isGameActive = false;
        
        // Renk Paleti
        const colors = {
            fog: 0xeef2f3, 
            ground: 0xeef2f3,
            penguinBlack: 0x1a1a1a,
            penguinWhite: 0xffffff,
            mountain: 0xdde4e8
        };

        // --- Başlangıç ---
        init3D();
        animate();

        document.getElementById('start-btn').addEventListener('click', () => {
            document.getElementById('start-screen').style.display = 'none';
            document.getElementById('joystick-zone').style.display = 'block';
            isGameActive = true;
            initJoystick();
            
            // İlk başlangıçta kamerayı hemen oturtalım ki kayma olmasın
            const relativeCameraOffset = new THREE.Vector3(0, 5, -10);
            const cameraOffset = relativeCameraOffset.applyMatrix4(penguinGroup.matrixWorld);
            camera.position.copy(cameraOffset);
            camera.lookAt(penguinGroup.position);

            if (document.documentElement.requestFullscreen) {
                document.documentElement.requestFullscreen().catch(e => {});
            }
        });

        function init3D() {
            scene = new THREE.Scene();
            scene.background = new THREE.Color(colors.fog);
            scene.fog = new THREE.FogExp2(colors.fog, 0.015);

            // Kamera başlangıç pozisyonu (Burayı düzelttik)
            camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(0, 5, -10); // Biraz daha geriye ve yukarıya

            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.shadowMap.enabled = true;
            document.getElementById('canvas-container').appendChild(renderer.domElement);

            // Işıklar
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
            scene.add(ambientLight);
            const dirLight = new THREE.DirectionalLight(0xffffff, 0.5);
            dirLight.position.set(50, 100, 50);
            dirLight.castShadow = true;
            scene.add(dirLight);

            // Zemin
            const planeGeometry = new THREE.PlaneGeometry(2000, 2000);
            const planeMaterial = new THREE.MeshPhongMaterial({ color: colors.ground, shininess: 0 });
            const ground = new THREE.Mesh(planeGeometry, planeMaterial);
            ground.rotation.x = -Math.PI / 2;
            ground.receiveShadow = true;
            scene.add(ground);

            createMountains();
            createPlayerPenguen();
            createSociety();

            // KRİTİK DÜZELTME: Sahne yüklenince kamera hemen penguene baksın.
            camera.lookAt(penguinGroup.position);

            window.addEventListener('resize', onWindowResize, false);
        }

        // ... (Penguen oluşturma fonksiyonları aynı)
        function createPenguenMesh() {
            const group = new THREE.Group();
            const bodyGeo = new THREE.CapsuleGeometry(0.5, 1, 4, 8);
            const bodyMat = new THREE.MeshStandardMaterial({ color: colors.penguinBlack });
            const body = new THREE.Mesh(bodyGeo, bodyMat);
            body.position.y = 0.75; body.castShadow = true; group.add(body);
            const bellyGeo = new THREE.CapsuleGeometry(0.35, 0.8, 4, 8);
            const bellyMat = new THREE.MeshStandardMaterial({ color: colors.penguinWhite });
            const belly = new THREE.Mesh(bellyGeo, bellyMat);
            belly.position.set(0, 0.7, 0.25); group.add(belly);
            const headGeo = new THREE.SphereGeometry(0.4, 16, 16);
            const head = new THREE.Mesh(headGeo, bodyMat);
            head.position.y = 1.6; group.add(head);
            const beakGeo = new THREE.ConeGeometry(0.1, 0.3, 8);
            const beakMat = new THREE.MeshStandardMaterial({ color: 0xffa500 });
            const beak = new THREE.Mesh(beakGeo, beakMat);
            beak.rotation.x = Math.PI / 2; beak.position.set(0, 1.6, 0.5); group.add(beak);
            const flipperGeo = new THREE.BoxGeometry(0.8, 0.1, 0.3);
            const flipper = new THREE.Mesh(flipperGeo, bodyMat);
            flipper.position.set(0, 1.2, 0); group.add(flipper);
            return group;
        }

        function createPlayerPenguen() {
            penguinGroup = new THREE.Group();
            const mesh = createPenguenMesh();
            penguinGroup.add(mesh);
            scene.add(penguinGroup);
        }

        function createSociety() {
            societyGroup = new THREE.Group();
            for(let i=0; i<7; i++) {
                const p = createPenguenMesh();
                p.position.set((Math.random() - 0.5) * 20, 0, -40 - (Math.random() * 30));
                p.rotation.y = Math.PI; // Bize bakıyorlar
                societyGroup.add(p);
            }
            scene.add(societyGroup);
        }

        function createMountains() {
            for (let i = 0; i < 50; i++) {
                const h = 30 + Math.random() * 60;
                const geo = new THREE.ConeGeometry(15 + Math.random()*30, h, 4);
                const mat = new THREE.MeshStandardMaterial({ color: colors.mountain, flatShading: true, roughness: 1 });
                const mesh = new THREE.Mesh(geo, mat);
                const angle = Math.random() * Math.PI * 2;
                const radius = 200 + Math.random() * 150;
                mesh.position.x = Math.cos(angle) * radius;
                mesh.position.z = Math.sin(angle) * radius;
                mesh.position.y = h / 2 - 10;
                scene.add(mesh);
            }
        }

        function initJoystick() {
            joystickManager = nipplejs.create({
                zone: document.getElementById('joystick-zone'),
                mode: 'dynamic',
                position: { left: '50%', top: '50%' },
                color: 'white',
                size: 120,
                dynamicPage: true,
                restOpacity: 0.5, // Görünürlüğü artırdım
                fadeTime: 200
            });
            joystickManager.on('move', (evt, data) => {
                if(data.vector) { moveData.forward = data.vector.y; moveData.turn = -data.vector.x; }
            });
            joystickManager.on('end', () => { moveData.forward = 0; moveData.turn = 0; });
        }

        function updateGameLogic() {
            if (!isGameActive) return;

            const speed = 0.25;
            const turnSpeed = 0.07;

            penguinGroup.rotation.y += moveData.turn * turnSpeed;

            if (moveData.forward > 0.1) {
                const direction = new THREE.Vector3(0, 0, 1);
                direction.applyAxisAngle(new THREE.Vector3(0, 1, 0), penguinGroup.rotation.y);
                penguinGroup.position.add(direction.multiplyScalar(speed * moveData.forward));
                // Basit yürüme efekti
                penguinGroup.children[0].rotation.z = Math.sin(Date.now() * 0.012) * 0.15;
                penguinGroup.position.y = Math.abs(Math.sin(Date.now() * 0.012)) * 0.1;
            } else {
                 penguinGroup.children[0].rotation.z = 0;
                 penguinGroup.position.y = 0;
            }

            // Kamera Takibi
            const relativeCameraOffset = new THREE.Vector3(0, 5, -10);
            const cameraOffset = relativeCameraOffset.applyMatrix4(penguinGroup.matrixWorld);
            camera.position.lerp(cameraOffset, 0.1);
            camera.lookAt(penguinGroup.position);

            // Nihilizm Mekaniği (Toplumdan Kaçış)
            const dist = penguinGroup.position.distanceTo(societyGroup.position);
            if (dist < 50) {
               const direction = new THREE.Vector3(0, 0, 1);
               direction.applyAxisAngle(new THREE.Vector3(0, 1, 0), penguinGroup.rotation.y);
               // Eğer onlara doğru gidiyorsak, onları uzaklaştır
               if(moveData.forward > 0.1) {
                   societyGroup.position.add(direction.multiplyScalar(speed * moveData.forward * 1.1));
               }
            }
        }

        function animate() {
            requestAnimationFrame(animate);
            updateGameLogic();
            renderer.render(scene, camera);
        }

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }
    </script>
</body>
</html>
